<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AK Brands - Master Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #f5f7fa; padding-bottom: 50px; }
        .main-app { padding: 15px; max-width: 1400px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .btn { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; }
        .btn-primary { background: #667eea; color: white; }
        .btn-sold { background: #64748b; color: white; }
        .btn-delete { background: #ef4444; color: white; }
        .btn-export { background: #10b981; color: white; font-size: 11px; margin-right: 5px; }
        .table-container { background: white; border-radius: 12px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; font-size: 13px; }
        .sold-out-row { opacity: 0.5; background: #f1f5f9; }
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); align-items:center; justify-content:center; z-index: 1000; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 95%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        label { display: block; font-size: 11px; font-weight: 700; color: #666; margin-bottom: 4px; }
        input, textarea, select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 100%; font-size: 14px; margin-bottom: 10px; }
        .admin-only { display: none; }
    </style>
</head>
<body>
    <div class="main-app">
        <div class="header">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>üì¶ AK Brands Master Inventory</h2>
                <button class="btn btn-primary" onclick="toggleAdmin()">Admin Mode ‚öôÔ∏è</button>
            </div>
            <div id="adminControls" class="admin-only" style="margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
                <button class="btn btn-primary" onclick="openModal()">+ Add New Lot</button>
                <div style="float:right;">
                    <button class="btn btn-export" onclick="exportExcel()">Excel</button>
                    <button class="btn btn-export" onclick="exportPDF()">PDF</button>
                    <button class="btn btn-export" onclick="exportJSON()">JSON</button>
                </div>
            </div>
        </div>
        <div class="table-container" id="tableContainer"></div>
    </div>

    <div class="modal" id="lotModal">
        <div class="modal-content">
            <h3 id="modalTitle">Add New Lot</h3><br>
            <input type="hidden" id="editIndex">
            <div class="form-grid">
                <div><label>Lot Number</label><input type="text" id="lotNumber"></div>
                <div><label>Category</label><input type="text" id="category"></div>
                <div><label>Condition</label><input type="text" id="condition" placeholder="e.g. Fresh / Surplus"></div>
                <div><label>Total Qty</label><input type="number" id="quantity"></div>
                <div><label>MOQ</label><input type="number" id="moq"></div>
                <div><label>Lot Rate (‚Çπ)</label><input type="number" id="lotRate"></div>
                <div><label>AK Offer (‚Çπ)</label><input type="number" id="akOffer"></div>
                <div><label>MRP</label><input type="number" id="mrp"></div>
                <div><label>Online Price</label><input type="number" id="onlinePrice"></div>
                <div><label>Location</label><input type="text" id="location"></div>
            </div>
            <label>Show Negotiation?</label>
            <select id="showCustomerOffer"><option value="no">No</option><option value="yes">Yes</option></select>
            <label>Description</label><textarea id="description" rows="2"></textarea>
            <label>Internal Remarks</label><input type="text" id="remarks">
            
            <button class="btn btn-primary" style="width:100%" onclick="saveLot()">Save Inventory</button>
            <button class="btn" style="width:100%; margin-top:10px;" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <script>
        let isAdmin = false;
        function toggleAdmin() { isAdmin = !isAdmin; document.querySelectorAll('.admin-only').forEach(el => el.style.display = isAdmin ? 'block' : 'none'); renderTable(); }

        function saveLot() {
            const idx = document.getElementById('editIndex').value;
            const lot = {
                lotNumber: document.getElementById('lotNumber').value,
                category: document.getElementById('category').value,
                condition: document.getElementById('condition').value,
                quantity: document.getElementById('quantity').value,
                moq: document.getElementById('moq').value,
                lotRate: document.getElementById('lotRate').value,
                akOffer: document.getElementById('akOffer').value,
                mrp: document.getElementById('mrp').value,
                onlinePrice: document.getElementById('onlinePrice').value,
                showCustomerOffer: document.getElementById('showCustomerOffer').value,
                location: document.getElementById('location').value,
                description: document.getElementById('description').value,
                remarks: document.getElementById('remarks').value,
                status: idx !== "" ? (JSON.parse(localStorage.getItem('akBrandsLots'))[idx].status || 'Available') : 'Available'
            };

            let lots = JSON.parse(localStorage.getItem('akBrandsLots')) || [];
            if(idx !== "") lots[idx] = lot; else lots.push(lot);
            
            localStorage.setItem('akBrandsLots', JSON.stringify(lots));
            closeModal(); renderTable();
        }

        function renderTable() {
            const lots = JSON.parse(localStorage.getItem('akBrandsLots')) || [];
            let html = `<table><tr><th>Lot #</th><th>Category</th><th>Qty</th><th>Price</th><th>Status</th><th>Actions</th></tr>`;
            lots.forEach((l, i) => {
                const isSold = l.status === 'Sold Out';
                const params = new URLSearchParams(l).toString();
                const link = `https://zaffarsecure-lab.github.io/ak-brands-website/lot-details.html?${params}`;
                
                html += `<tr class="${isSold ? 'sold-out-row' : ''}">
                    <td><a href="${link}" target="_blank" style="color:#007bff; font-weight:700;">${l.lotNumber}</a></td>
                    <td>${l.category}</td>
                    <td>${l.quantity}</td>
                    <td style="color:#667eea; font-weight:700;">‚Çπ${l.akOffer}</td>
                    <td><span style="color:${isSold ? 'red':'green'}">${l.status || 'Available'}</span></td>
                    <td>
                        <button class="btn" style="background:#25D366; color:white;" onclick='shareWA(${JSON.stringify(l)})'>WA</button>
                        ${isAdmin ? `
                            <button class="btn btn-primary" style="padding:5px;" onclick="editLot(${i})">Edit</button>
                            <button class="btn btn-sold" style="padding:5px;" onclick="toggleSold(${i})">Sold</button>
                            <button class="btn btn-primary" style="background:#333; padding:5px;" onclick='copyText(${JSON.stringify(l)}, "${link}")'>Copy</button>
                            <button class="btn btn-delete" style="padding:5px;" onclick="deleteLot(${i})">X</button>
                        ` : ''}
                    </td>
                </tr>`;
            });
            document.getElementById('tableContainer').innerHTML = html + `</table>`;
        }

        function copyText(l, link) {
            let msg = `1. Lot Number: ${l.lotNumber}\n2. Category: ${l.category}\n3. Condition: ${l.condition}\n4. Quantity: ${l.quantity}\n5. MOQ: ${l.moq}\n`;
            if(l.mrp) msg += `6. MRP: ‚Çπ${l.mrp}\n`;
            if(l.onlinePrice) msg += `7. Online Price: ‚Çπ${l.onlinePrice}\n`;
            msg += `8. Lot Rate: ${l.lotRate}\n\nüîó View Details: ${link}\n\nTrusted firm\nAK Brands Marketing¬©\nwww.akbrandsmarketing.com\n\nhttps://chat.whatsapp.com/FnBohcWrSobFcloZwC6Hnq`;
            navigator.clipboard.writeText(msg);
            alert("Copied to Clipboard!");
        }

        function toggleSold(i) {
            let lots = JSON.parse(localStorage.getItem('akBrandsLots'));
            lots[i].status = lots[i].status === 'Sold Out' ? 'Available' : 'Sold Out';
            localStorage.setItem('akBrandsLots', JSON.stringify(lots));
            renderTable();
        }

        function deleteLot(i) { if(confirm("Delete Permanently?")) { let lots = JSON.parse(localStorage.getItem('akBrandsLots')); lots.splice(i,1); localStorage.setItem('akBrandsLots', JSON.stringify(lots)); renderTable(); } }
        function editLot(i) {
            const lots = JSON.parse(localStorage.getItem('akBrandsLots'));
            const l = lots[i];
            document.getElementById('editIndex').value = i;
            document.getElementById('lotNumber').value = l.lotNumber;
            document.getElementById('category').value = l.category;
            document.getElementById('condition').value = l.condition;
            document.getElementById('quantity').value = l.quantity;
            document.getElementById('moq').value = l.moq;
            document.getElementById('lotRate').value = l.lotRate;
            document.getElementById('akOffer').value = l.akOffer;
            document.getElementById('mrp').value = l.mrp || '';
            document.getElementById('onlinePrice').value = l.onlinePrice || '';
            document.getElementById('location').value = l.location;
            document.getElementById('description').value = l.description;
            document.getElementById('remarks').value = l.remarks;
            document.getElementById('modalTitle').innerText = "Edit Lot " + l.lotNumber;
            openModal();
        }

        function exportExcel() {
            const lots = JSON.parse(localStorage.getItem('akBrandsLots'));
            const ws = XLSX.utils.json_to_sheet(lots);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Inventory");
            XLSX.writeFile(wb, "AK_Brands_Inventory.xlsx");
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text("AK Brands Marketing - Inventory Report", 14, 15);
            const lots = JSON.parse(localStorage.getItem('akBrandsLots')).map(l => [l.lotNumber, l.category, l.quantity, l.akOffer, l.status]);
            doc.autoTable({ head: [['Lot#', 'Category', 'Qty', 'Price', 'Status']], body: lots, startY: 20 });
            doc.save("Inventory_Report.pdf");
        }

        function openModal() { document.getElementById('lotModal').classList.add('active'); }
        function closeModal() { document.getElementById('lotModal').classList.remove('active'); document.getElementById('editIndex').value = ""; }
        renderTable();
    </script>
</body>
</html>
