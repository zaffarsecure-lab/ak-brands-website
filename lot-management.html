<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AK Brands - Master Admin</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #4f46e5; --secondary: #64748b; --success: #10b981; --danger: #ef4444; --ak-dark: #1e293b; --wa-green: #25d366; --warn: #f59e0b; }
        body { font-family: 'Inter', sans-serif; background: #f1f5f9; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        /* Header & Tabs */
        .header-flex { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; }
        .tab-btn { padding: 12px 24px; border-radius: 10px; border: none; background: transparent; cursor: pointer; font-weight: 700; color: var(--secondary); transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; }

        /* Controls - Redesigned to remove Stats */
        .controls { display: flex; flex-wrap: wrap; gap: 15px; background: #f8fafc; padding: 20px; border-radius: 15px; margin-bottom: 20px; align-items: flex-end; }
        .input-group { display: flex; flex-direction: column; gap: 5px; flex-grow: 1; }
        label { font-size: 11px; font-weight: 800; color: var(--secondary); text-transform: uppercase; }
        input, select, textarea { padding: 12px; border-radius: 8px; border: 1px solid #cbd5e1; outline: none; font-family: inherit; }

        .btn { padding: 12px 20px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; color: white; transition: 0.2s; }
        .btn-add { background: var(--primary); white-space: nowrap; }
        .btn-excel { background: #166534; }
        
        /* Table Styling */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; background: #f8fafc; padding: 15px; font-size: 12px; color: var(--secondary); text-transform: uppercase; border-bottom: 2px solid #e2e8f0; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        .lot-link { color: #4f46e5; text-decoration: none; font-weight: 800; cursor: pointer; }

        .badge { padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: 800; }
        .status-available { background: #dcfce7; color: #166534; }
        .status-sold { background: #fee2e2; color: #991b1b; }
        
        .view-section { display: none; }
        .view-section.active { display: block; }

        /* Action Buttons */
        .action-btn { padding: 6px 12px; border-radius: 6px; border: none; color: white; cursor: pointer; font-size: 12px; font-weight: bold; }
        .btn-copy { background: var(--success); }
        .btn-status { background: var(--warn); }
        .btn-del { background: var(--danger); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 95%; max-width: 600px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-flex">
        <h2>ðŸ“¦ AK Brands Inventory Suite</h2>
        <button class="btn btn-excel" onclick="exportData()">Excel Export</button>
    </div>

    <div class="tabs">
        <button id="tab-inventory" class="tab-btn active" onclick="switchTab('inventory')">ðŸ“¦ Inventory</button>
        <button id="tab-customers" class="tab-btn" onclick="switchTab('customers')">ðŸ‘¥ Customers</button>
        <button id="tab-suppliers" class="tab-btn" onclick="switchTab('suppliers')">ðŸš› Suppliers</button>
    </div>

    <div class="controls">
        <div class="input-group">
            <label>Search Database</label>
            <input type="text" id="masterSearch" placeholder="Search Lot #, Category, Location..." onkeyup="applyFilters()">
        </div>
        <button class="btn btn-add" id="actionBtn" onclick="openModal()">+ Add New Lot</button>
    </div>

    <div id="inventorySection" class="view-section active">
        <table>
            <thead><tr><th>Lot #</th><th>Category</th><th>Qty</th><th>Location</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody id="inventoryBody"></tbody>
        </table>
    </div>

    <div id="customersSection" class="view-section">
        <table>
            <thead><tr><th>Name</th><th>Phone</th><th>Interest</th><th>Follow-up</th><th>Actions</th></tr></thead>
            <tbody id="customerBody"></tbody>
        </table>
    </div>

    <div id="suppliersSection" class="view-section">
        <table>
            <thead><tr><th>Company</th><th>Person</th><th>Category</th><th>Phone</th><th>Actions</th></tr></thead>
            <tbody id="supplierBody"></tbody>
        </table>
    </div>
</div>

<div id="inventoryModal" class="modal">
    <div class="modal-content">
        <h3>ðŸ“¦ Add New Inventory Lot</h3>
        <form onsubmit="saveEntry(event, 'inventory')">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom: 20px;">
                <input type="text" name="lotNumber" placeholder="Lot #" required>
                <input type="text" name="category" placeholder="Category" required>
                <input type="text" name="quantity" placeholder="Qty (e.g. 500 Pcs)" required>
                <input type="text" name="location" placeholder="Location" required>
                <input type="number" name="akOffer" placeholder="Rate" required>
                <select name="status"><option value="AVAILABLE">AVAILABLE</option><option value="SOLD">SOLD</option></select>
            </div>
            <button type="submit" class="btn btn-add" style="width:100%">Save Lot</button>
        </form>
    </div>
</div>

<script>
    const DB_URL = "https://ak-brands-marketing-default-rtdb.firebaseio.com";
    let currentTab = 'inventory';
    let rawData = { inventory: [], customers: [], suppliers: [] };

    async function loadData() {
        const [inv, cust, supp] = await Promise.all([
            fetch(`${DB_URL}/inventory.json`).then(r => r.json()),
            fetch(`${DB_URL}/customers.json`).then(r => r.json()),
            fetch(`${DB_URL}/suppliers.json`).then(r => r.json())
        ]);
        rawData.inventory = Object.keys(inv || {}).map(k => ({ id: k, ...inv[k] })).sort((a,b) => b.lotNumber - a.lotNumber);
        rawData.customers = Object.keys(cust || {}).map(k => ({ id: k, ...cust[k] }));
        rawData.suppliers = Object.keys(supp || {}).map(k => ({ id: k, ...supp[k] }));
        applyFilters();
    }

    function switchTab(t) {
        currentTab = t;
        document.querySelectorAll('.tab-btn, .view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-'+t).classList.add('active');
        document.getElementById(t+'Section').classList.add('active');
        document.getElementById('actionBtn').innerText = t === 'inventory' ? "+ Add New Lot" : (t === 'customers' ? "+ Add Customer" : "+ Add Supplier");
        applyFilters();
    }

    function applyFilters() {
        const q = document.getElementById('masterSearch').value.toLowerCase();
        const filtered = rawData[currentTab].filter(item => JSON.stringify(item).toLowerCase().includes(q));
        renderTable(filtered);
    }

    function renderTable(data) {
        const body = document.getElementById(currentTab + 'Body');
        if(currentTab === 'inventory') {
            body.innerHTML = data.map(i => `
                <tr>
                    <td><a class="lot-link" href="lot-details.html?lotNumber=${i.lotNumber}">${i.lotNumber}</a></td>
                    <td>${i.category}</td>
                    <td>${i.quantity}</td>
                    <td>${i.location}</td>
                    <td><span class="badge ${i.status === 'SOLD' ? 'status-sold' : 'status-available'}">${i.status || 'AVAILABLE'}</span></td>
                    <td style="display:flex; gap:5px;">
                        <button class="action-btn btn-copy" onclick="copyLink('${i.lotNumber}')">Copy</button>
                        <button class="action-btn btn-status" onclick="toggleStatus('${i.id}', '${i.status}')">Status</button>
                        <button class="action-btn btn-del" onclick="deleteEntry('${i.id}', 'inventory')">Del</button>
                    </td>
                </tr>
            `).join('');
        }
        // ... (Render logic for Customers/Suppliers similarly)
    }

    function openModal() { document.getElementById(currentTab + 'Modal').style.display = 'flex'; }
    
    async function saveEntry(e, type) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target));
        await fetch(`${DB_URL}/${type}.json`, { method: 'POST', body: JSON.stringify(data) });
        location.reload();
    }

    async function toggleStatus(id, current) {
        const next = current === 'SOLD' ? 'AVAILABLE' : 'SOLD';
        await fetch(`${DB_URL}/inventory/${id}.json`, { method: 'PATCH', body: JSON.stringify({ status: next }) });
        loadData();
    }

    async function deleteEntry(id, type) {
        if(confirm("Delete this entry?")) {
            await fetch(`${DB_URL}/${type}/${id}.json`, { method: 'DELETE' });
            loadData();
        }
    }

    function copyLink(num) {
        const link = `https://akbrandsmarketing.com/lot-details.html?lotNumber=${num}`;
        navigator.clipboard.writeText(link).then(() => alert("Link Copied!"));
    }

    window.onclick = (e) => { if(e.target.className === 'modal') e.target.style.display = 'none'; };
    loadData();
</script>
</body>
</html>
