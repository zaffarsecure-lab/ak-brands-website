<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking - AK Brands</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #f5f7fa; padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; max-width: 500px; margin: 0 auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .sold-banner { background: #ef4444; color: white; text-align: center; padding: 10px; border-radius: 8px; font-weight: 700; margin-bottom: 15px; display: none; }
        .price-section { display: flex; gap: 10px; margin: 15px 0; }
        .p-chip { flex: 1; padding: 10px; border-radius: 8px; text-align: center; }
        .lot-chip { background: #f1f5f9; color: #334155; border: 1px solid #e2e8f0; }
        .ak-chip { background: #667eea; color: white; }
        .mrp-online { display: flex; gap: 10px; margin-bottom: 15px; font-size: 12px; font-weight: 700; color: #888; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 10px; color: #999; text-transform: uppercase; font-weight: 800; }
        .booking-box { background: #f8fafc; border: 2px solid #e2e8f0; padding: 15px; border-radius: 12px; margin-top: 20px; }
        input { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 15px; }
        .btn-wa { display: block; background: #25D366; color: white; text-align: center; padding: 15px; border-radius: 10px; text-decoration: none; font-weight: 700; margin-top: 15px; opacity: 0.4; pointer-events: none; }
        .btn-wa.active { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body>
    <div class="card">
        <div id="soldMsg" class="sold-banner">⚠️ THIS LOT IS SOLD OUT</div>
        <h2 id="cat">Loading...</h2>
        <p style="color:#667eea; font-weight:700;">Lot #<span id="lnum">---</span> | <span id="cond">---</span></p>

        <div id="extraPrices" class="mrp-online"></div>

        <div class="price-section">
            <div class="p-chip lot-chip"><label>Lot Rate</label><div style="font-size:18px; font-weight:700;">₹<span id="lrate">0</span></div></div>
            <div class="p-chip ak-chip"><label style="color:#e0e7ff;">AK Offer</label><div style="font-size:18px; font-weight:700;">₹<span id="akr">0</span></div></div>
        </div>

        <div class="grid">
            <div><label>Total Qty</label><p id="qty">0</p></div>
            <div><label>Min. Order (MOQ)</label><p id="moq">0</p></div>
            <div><label>Location</label><p id="loc">---</p></div>
            <div><label>Description</label><p id="desc" style="font-weight:400; font-size:13px;">---</p></div>
        </div>

        <div class="booking-box" id="bookForm">
            <h4 style="margin-bottom:10px;">Stock Booking Form</h4>
            <div id="negSection" style="display:none; margin-bottom:15px;">
                <label style="color:#667eea;">Your Target Price (Negotiation)</label>
                <input type="text" id="custNeg" placeholder="Enter your price">
            </div>
            <label>WhatsApp Number (Mandatory) *</label>
            <input type="number" id="custPhone" oninput="validate()" placeholder="e.g. 98XXXXXXXX">
            <label style="margin-top:10px;">Quantity (Min <span id="moqCheck">0</span>) *</label>
            <input type="number" id="orderQty" oninput="validate()" placeholder="Enter quantity">
            
            <a href="#" id="waBtn" class="btn-wa" onclick="sendBooking()">BOOK VIA WHATSAPP</a>
        </div>
    </div>

    <script>
        const p = new URLSearchParams(window.location.search);
        const moq = parseInt(p.get('moq')) || 0;
        
        if(p.get('status') === 'Sold Out') {
            document.getElementById('soldMsg').style.display = 'block';
            document.getElementById('bookForm').style.display = 'none';
        }

        document.getElementById('cat').innerText = p.get('category');
        document.getElementById('lnum').innerText = p.get('lotNumber');
        document.getElementById('cond').innerText = p.get('condition');
        document.getElementById('lrate').innerText = p.get('lotRate');
        document.getElementById('akr').innerText = p.get('akOffer');
        document.getElementById('qty').innerText = p.get('quantity');
        document.getElementById('moq').innerText = moq;
        document.getElementById('moqCheck').innerText = moq;
        document.getElementById('loc').innerText = p.get('location');
        document.getElementById('desc').innerText = p.get('description');

        let ex = '';
        if(p.get('mrp')) ex += `<span>MRP: ₹${p.get('mrp')}</span>`;
        if(p.get('onlinePrice')) ex += `<span style="margin-left:10px;">ONLINE: ₹${p.get('onlinePrice')}</span>`;
        document.getElementById('extraPrices').innerHTML = ex;

        if(p.get('showCustomerOffer') === 'yes') document.getElementById('negSection').style.display = 'block';

        function validate() {
            const q = parseInt(document.getElementById('orderQty').value) || 0;
            const ph = document.getElementById('custPhone').value;
            const btn = document.getElementById('waBtn');
            // Check: Qty >= MOQ AND Phone length >= 10
            if(q >= moq && ph.trim().length >= 10) btn.classList.add('active');
            else btn.classList.remove('active');
        }

        function sendBooking() {
            const qty = document.getElementById('orderQty').value;
            const ph = document.getElementById('custPhone').value;
            const neg = document.getElementById('custNeg').value;
            const status = neg ? `⚠️ NEGOTIATION REQUEST: ₹${neg}` : "✅ DIRECT BOOKING";
            const msg = `*STOCK BOOKING REQUEST*\n--------------------------\n${status}\n\n*Lot:* ${p.get('lotNumber')}\n*Item:* ${p.get('category')}\n*Qty:* ${qty}\n*Client Phone:* ${ph}\n\n*Prices:*\nLot Rate: ₹${p.get('lotRate')}\nAK Offer: ₹${p.get('akOffer')}`;
            window.open(`https://wa.me/918660502217?text=${encodeURIComponent(msg)}`, '_blank');
        }
    </script>
</body>
</html>
