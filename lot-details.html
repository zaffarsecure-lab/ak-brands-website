<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lot Details - AK Brands</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #f5f7fa; color: #333; line-height: 1.6; }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; }
        .card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header { border-bottom: 2px solid #eee; margin-bottom: 20px; padding-bottom: 10px; }
        .lot-number { color: #667eea; font-weight: 700; font-size: 1.2rem; }
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .detail-item label { display: block; font-size: 0.8rem; color: #888; text-transform: uppercase; font-weight: 600; }
        .detail-item p { font-size: 1.1rem; font-weight: 500; }
        .description { margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        .btn-back { display: inline-block; margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; }
        .error-box { text-align: center; padding: 50px; }
        .error-icon { font-size: 4rem; color: #ff4d4d; }
    </style>
</head>
<body>

    <div class="container" id="mainContent">
        <div class="card">
            <div class="header">
                <span class="lot-number">Lot #<span id="displayLotNumber">---</span></span>
                <h1 id="displayCategory">Loading...</h1>
            </div>

            <div class="detail-grid">
                <div class="detail-item">
                    <label>Location</label>
                    <p id="displayLocation">---</p>
                </div>
                <div class="detail-item">
                    <label>Quantity</label>
                    <p id="displayQuantity">---</p>
                </div>
                <div class="detail-item">
                    <label>Condition</label>
                    <p id="displayCondition">New</p>
                </div>
                <div class="detail-item">
                    <label>Status</label>
                    <p style="color: green;">Available</p>
                </div>
            </div>

            <div class="description">
                <label style="display: block; font-size: 0.8rem; color: #888; text-transform: uppercase; font-weight: 600;">Description</label>
                <p id="displayDescription">---</p>
            </div>

            <a href="lot-management.html" class="btn-back">← Back to Inventory</a>
        </div>
    </div>

    <script>
        async function loadDetails() {
            const params = new URLSearchParams(window.location.search);
            // We check for both "lotNumber" (from management) and "lot" (for general use)
            const lotId = params.get('lotNumber') || params.get('lot');

            if (!lotId) {
                showError("No Lot ID provided");
                return;
            }

            // 1. Try to read from the URL directly (Instant Phone Test)
            if (params.get('category')) {
                const urlData = {
                    lotNumber: lotId,
                    category: params.get('category'),
                    location: params.get('location'),
                    quantity: params.get('quantity'),
                    description: params.get('description')
                };
                renderData(urlData);
                return;
            }

            // 2. If not in URL, try to fetch from GitHub file
            try {
                const response = await fetch('lots.json');
                const lots = await response.json();
                const lot = lots.find(l => l.lotNumber == lotId);
                
                if (lot) {
                    renderData(lot);
                } else {
                    showError("Lot Not Found in System");
                }
            } catch (error) {
                showError("Could not load database");
            }
        }

        function renderData(data) {
            document.getElementById('displayLotNumber').innerText = data.lotNumber || '---';
            document.getElementById('displayCategory').innerText = data.category || '---';
            document.getElementById('displayLocation').innerText = data.location || '---';
            document.getElementById('displayQuantity').innerText = data.quantity || '---';
            document.getElementById('displayDescription').innerText = data.description || 'No description available.';
            document.title = `Lot ${data.lotNumber} - ${data.category}`;
        }

        function showError(msg) {
            document.getElementById('mainContent').innerHTML = `
                <div class="card error-box">
                    <div class="error-icon">❌</div>
                    <h2>${msg}</h2>
                    <p>The requested lot doesn't exist yet.</p>
                    <a href="lot-management.html" class="btn-back">Back to List</a>
                </div>`;
        }

        // Start the process
        loadDetails();
    </script>
</body>
</html>
